!function($,window,document,undefined){function GdriveFilePicker(a,b){this.element=a,this.options=$.extend({},defaults,b),this._defaults=defaults,this._name=pluginName,this._init()}var pluginName="gdriveFilePicker",defaults={fixed:!1,apiKey:null,clientId:null,scopes:["https://www.googleapis.com/auth/drive.readonly"],features:["google.picker.Feature.MULTISELECT_ENABLED"],views:["google.picker.ViewId.DOCUMENTS"],onPicked:null};GdriveFilePicker.prototype={open:function(){var a=gapi.auth.getToken();a?this._showPicker():this._doAuth(!1,function(){this._showPicker()}.bind(this))},_init:function(){this.element.addEventListener("click",this.open.bind(this)),this.element.disabled=!0,gapi.client.setApiKey(this.options.apiKey),gapi.client.load("drive","v2",this._driveApiLoaded.bind(this)),google.load("picker","1",{callback:this._pickerApiLoaded.bind(this)})},_showPicker:function(){var accessToken=gapi.auth.getToken().access_token;this.picker=(new google.picker.PickerBuilder).setAppId(this.options.clientId).setOAuthToken(accessToken).setCallback(this._pickerCallback.bind(this));for(i in this.options.views)this.picker.addView(eval(this.options.views[i]));for(i in this.options.features)this.picker.enableFeature(eval(this.options.features[i]));"function"==typeof this.options.beforeShow&&this.options.beforeShow.call(this,this.picker),this.picker.build().setVisible(!0)},_pickerCallback:function(a){if(a[google.picker.Response.ACTION]==google.picker.Action.PICKED)for(i in a[google.picker.Response.DOCUMENTS]){var b=a[google.picker.Response.DOCUMENTS][i],c=b[google.picker.Document.ID],d=gapi.client.drive.files.get({fileId:c});d.execute(this._fileGetCallback.bind(this))}},_fileGetCallback:function(a){this.options.onPicked&&this.options.onPicked.call(this.element,a)},_pickerApiLoaded:function(){this.element.disabled=!1},_driveApiLoaded:function(){this._doAuth(!0)},_doAuth:function(a,b){"undefined"==typeof b&&(b=function(){}),gapi.auth.authorize({client_id:this.options.clientId+".apps.googleusercontent.com",scope:this.options.scopes,immediate:a},b)}},$.fn.gdriveFilePicker=function(a){return this.each(function(){var b=$.data(this,"plugin_"+pluginName);b?$.data(this,"plugin_"+pluginName):$.data(this,"plugin_"+pluginName,new GdriveFilePicker(this,a)),"string"==typeof a&&b[a]()})}}(jQuery,window,document);